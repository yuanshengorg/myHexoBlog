2、模型



进入虚拟环境，安装`pymysql`:

```
workon py_django
pip install pymysql
# （win）C:\Users\yuan\Envs\py_django\Lib\site-packages
# （Linux）~/.virtualenvs/py_django/lib/python3.5/site-packages
```

pymysql配置：

BookManager/__init__.py

```
import pymysql
pymysql.install_as_MySQLdb()
```

BookManager/setting.py

```
DATABASES = {
    'default': {
        # 'ENGINE': 'django.db.backends.sqlite3',
        # 'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'bookdb24',
        'HOST': 'LOCALHOST',
        'PORT': '3306',
        'USER': 'root',
        'PASSWORD': '123456',
    }
}
```



操作mysql数据库

```
mysql -uroot -p123456 # 登陆数据库
show databases; # 查看数据库
create database bookdb24 charset=utf8; # 创建名为bookdb24的数据库
use bookdb24; # 进入数据库
show tables; # 查看
exit; # 退出
```



Book/models.py

```python
from django.db import models


class BookInfo(models.Model):
    """书籍信息模型类"""

    name = models.CharField(max_length=20)  # 书籍名
    pub_date = models.DateField(null=True)  # 发布日期
    readcount = models.IntegerField(default=0)  # 阅读量
    commentcount = models.IntegerField(default=0)  # 评论量
    isDelete = models.BooleanField(default=False)  # 逻辑删除

    # 无类信息：修改表名
    class Meta:
        db_table = 'bookinfo'


class PeopleInfo(models.Model):
    """人物信息模型"""

    name = models.CharField(max_length=20)  # 人物姓名
    gender = models.BooleanField(default=True)  # 人物性别
    description = models.CharField(max_length=20)  # 人物描述
    isDelete = models.BooleanField(default=False)  # 逻辑删除
    book = models.ForeignKey(BookInfo)  # 外键约束，人物属于哪本书

    # 元类信息 : 修改表名
    class Meta:
        db_table = 'peopleinfo'

```



迁移模型：

```
cd d:\python/1010/Bookmanager # 进入Bookmanager项目目录
workon py_django  # 进入虚拟环境
python manage.py makemigrations  # 迁移目录
python manage.py migrate
```



查看mysql：

```
mysql -uroot -p123456
show databases;
use bookdb24;
show tables;

mysql> desc bookinfo;
+--------------+-------------+------+-----+---------+----------------+
| Field        | Type        | Null | Key | Default | Extra          |
+--------------+-------------+------+-----+---------+----------------+
| id           | int(11)     | NO   | PRI | NULL    | auto_increment |
| name         | varchar(20) | NO   |     | NULL    |                |
| pub_date     | date        | YES  |     | NULL    |                |
| readcount    | int(11)     | NO   |     | NULL    |                |
| commentcount | int(11)     | NO   |     | NULL    |                |
| isDelete     | tinyint(1)  | NO   |     | NULL    |                |
+--------------+-------------+------+-----+---------+----------------+
6 rows in set (0.07 sec)

mysql> desc peopleinfo;
+-------------+-------------+------+-----+---------+----------------+
| Field       | Type        | Null | Key | Default | Extra          |
+-------------+-------------+------+-----+---------+----------------+
| id          | int(11)     | NO   | PRI | NULL    | auto_increment |
| name        | varchar(20) | NO   |     | NULL    |                |
| gender      | tinyint(1)  | NO   |     | NULL    |                |
| description | varchar(20) | NO   |     | NULL    |                |
| isDelete    | tinyint(1)  | NO   |     | NULL    |                |
| book_id     | int(11)     | NO   | MUL | NULL    |                |
+-------------+-------------+------+-----+---------+----------------+
6 rows in set (0.01 sec)
```

上传数据；

```
charset gbk;  # win下设置为gbk

insert into bookinfo(name,pub_date,readcount,commentcount,isDelete) values
('射雕英雄传','1980-5-1',12,34,0),
('天龙八部','1986-7-24',36,40,0),
('笑傲江湖','1995-12-24',28,18,0),
('雪山飞狐','1987-11-11',58,24,0);

insert into peopleinfo(name,gender,book_id,description,isDelete) values
('郭靖',1,1,'降龙十八掌',0),
('黄蓉',0,1,'打狗棍法',0),
('黄药师',1,1,'弹指神通',0),
('欧阳锋',1,1,'蛤蟆功',0),
('梅超风',0,1,'九阴白骨爪',0),
('乔峰',1,2,'降龙十八掌',0),
('段誉',1,2,'六脉神剑',0),
('虚竹',1,2,'天山六阳掌',0),
('王语嫣',0,2,'神仙姐姐',0),
('令狐冲',1,3,'独孤九剑',0),
('任盈盈',0,3,'弹琴',0),
('岳不群',1,3,'华山剑法',0),
('东方不败',0,3,'葵花宝典',0),
('胡斐',1,4,'胡家刀法',0),
('苗若兰',0,4,'黄衣',0),
('程灵素',0,4,'医术',0),
('袁紫衣',0,4,'六合拳',0);
```

查看数据：

```
mysql> select * from bookinfo;
+----+------------+------------+-----------+--------------+----------+
| id | name       | pub_date   | readcount | commentcount | isDelete |
+----+------------+------------+-----------+--------------+----------+
|  1 | 射雕英雄传 | 1980-05-01 |        12 |           34 |        0 |
|  2 | 天龙八部   | 1986-07-24 |        36 |           40 |        0 |
|  3 | 笑傲江湖   | 1995-12-24 |        28 |           18 |        0 |
|  4 | 雪山飞狐   | 1987-11-11 |        58 |           24 |        0 |
+----+------------+------------+-----------+--------------+----------+
4 rows in set (0.02 sec)

mysql> select * from peopleinfo;
+----+----------+--------+-------------+----------+---------+
| id | name     | gender | description | isDelete | book_id |
+----+----------+--------+-------------+----------+---------+
|  1 | 郭靖     |      1 | 降龙十八掌  |        0 |       1 |
|  2 | 黄蓉     |      0 | 打狗棍法    |        0 |       1 |
|  3 | 黄药师   |      1 | 弹指神通    |        0 |       1 |
|  4 | 欧阳锋   |      1 | 蛤蟆功      |        0 |       1 |
|  5 | 梅超风   |      0 | 九阴白骨爪  |        0 |       1 |
|  6 | 乔峰     |      1 | 降龙十八掌  |        0 |       2 |
|  7 | 段誉     |      1 | 六脉神剑    |        0 |       2 |
|  8 | 虚竹     |      1 | 天山六阳掌  |        0 |       2 |
|  9 | 王语嫣   |      0 | 神仙姐姐    |        0 |       2 |
| 10 | 令狐冲   |      1 | 独孤九剑    |        0 |       3 |
| 11 | 任盈盈   |      0 | 弹琴        |        0 |       3 |
| 12 | 岳不群   |      1 | 华山剑法    |        0 |       3 |
| 13 | 东方不败 |      0 | 葵花宝典    |        0 |       3 |
| 14 | 胡斐     |      1 | 胡家刀法    |        0 |       4 |
| 15 | 苗若兰   |      0 | 黄衣        |        0 |       4 |
| 16 | 程灵素   |      0 | 医术        |        0 |       4 |
| 17 | 袁紫衣   |      0 | 六合拳      |        0 |       4 |
+----+----------+--------+-------------+----------+---------+
17 rows in set (0.00 sec)
```



Book/urls.py

```python
from django.conf.urls import url
from Book.views import bookList

urlpatterns = [
    url(r'^booklist/$', bookList)
]
```



views.py

```python
from django.shortcuts import render
from Book.models import BookInfo, PeopleInfo


def bookList(request):
    book_list = BookInfo.objects.all()
    
    context = {
        'book_list':book_list,
    }
    
    return render(request, 'Book/booklist.html', context)

```











